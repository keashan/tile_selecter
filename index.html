<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width initial-scale=1.0">
        <meta http-equiv="Permissions-Policy" content="interest-cohort=()">
        <title>Tile Selector</title>

        <link rel="stylesheet" type="text/css" href="static/css/tile_selector.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    </head>
    <body>
        <h1 class="title">Tile Selector</h1>
        <!-- <div class="popup">
            <span onclick="closeFolder()">&times</span>
            <div class="popup-content">
                <h2></h2>
                <div id="image-container"></div>
            </div>
        </div> -->
        <div class="content">
            <div class="color-folder">
                <div class="tile" id="Field_Tile_CPRISB_Dark_Grey__12x12">
                    <img src="static/images/9x9_Images/Dark Grey.jpg" class="tile-image" alt="">
                    <!-- <img src="static/images/Field_Tile_CPRISB_Dark_Grey__12x12/Field Tile CPRISB Dark Grey  12x12 F02.jpg" class="tile-image image2" alt="">
                    <img src="static/images/Field_Tile_CPRISB_Dark_Grey__12x12/Field Tile CPRISB Dark Grey  12x12 F03.jpg" class="tile-image image3" alt="">
                    <img src="static/images/Field_Tile_CPRISB_Dark_Grey__12x12/Field Tile CPRISB Dark Grey  12x12 F04.jpg" class="tile-image image4" alt="">
                    <img src="static/images/Field_Tile_CPRISB_Dark_Grey__12x12/Field Tile CPRISB Dark Grey  12x12 F05.jpg" class="tile-image image5" alt=""> -->
                </div>
                <span  class="color-name">
                    <label for="Dark_Grey">Dark Grey</label>
                </span>
                <input type="checkbox" id="Dark_Grey" name="Dark Grey" value="Dark Grey" class="color-checkbox" onchange="selectColor(this)">
            </div>
            <div class="color-folder">
                <div class="tile" id="Ironstone_Antique_Slate_12x12">
                    <img src="static/images/9x9_Images/Antique Slate.jpg" class="tile-image" alt="">
                    <!-- <img src="static/images/Ironstone_Antique_Slate_12x12/Ironstone Antique Slate 12x12 F02.jpg" class="tile-image image2" alt="">
                    <img src="static/images/Ironstone_Antique_Slate_12x12/Ironstone Antique Slate 12x12 F03.jpg" class="tile-image image3" alt="">
                    <img src="static/images/Ironstone_Antique_Slate_12x12/Ironstone Antique Slate 12x12 F04.jpg" class="tile-image image4" alt="">
                    <img src="static/images/Ironstone_Antique_Slate_12x12/Ironstone Antique Slate 12x12 F05.jpg" class="tile-image image5" alt=""> -->
                </div>
                <span  class="color-name">
                    <label for="Antique_Slate">Antique Slate</label>
                </span>
                <input type="checkbox" id="Antique_Slate" name="Antique Slate" value="Antique Slate" class="color-checkbox" onchange="selectColor(this)">
            </div>
            <div class="color-folder">
                <div class="tile" id="Ironstone_English_Grey_12x12">
                    <img src="static/images/9x9_Images/English Grey.jpg" class="tile-image" alt="">
                    <!-- <img src="static/images/Ironstone_English_Grey_12x12/Ironstone English Grey 12x12 F02.jpg" class="tile-image image2" alt="">
                    <img src="static/images/Ironstone_English_Grey_12x12/Ironstone English Grey 12x12 F03.jpg" class="tile-image image3" alt="">
                    <img src="static/images/Ironstone_English_Grey_12x12/Ironstone English Grey 12x12 F04.jpg" class="tile-image image4" alt="">
                    <img src="static/images/Ironstone_English_Grey_12x12/Ironstone English Grey 12x12 F05.jpg" class="tile-image image5" alt=""> -->
                </div>
                <span  class="color-name">
                    <label for="English_Grey">English Grey</label>
                </span>
                <input type="checkbox" id="English_Grey" name="English Grey" value="English Grey" class="color-checkbox" onchange="selectColor(this)">
            </div>
            <div class="color-folder">
                <div class="tile" id="Ironstone_French_Blend">
                    <img src="static/images/9x9_Images/French Blend.jpg" class="tile-image" alt="">
                    <!-- <img src="static/images/Ironstone_French_Blend/Ironstone French Blend F02.jpg" class="tile-image image2" alt="">
                    <img src="static/images/Ironstone_French_Blend/Ironstone French Blend F03.jpg" class="tile-image image3" alt="">
                    <img src="static/images/Ironstone_French_Blend/Ironstone French Blend F04.jpg" class="tile-image image4" alt="">
                    <img src="static/images/Ironstone_French_Blend/Ironstone French Blend F05.jpg" class="tile-image image5" alt=""> -->
                </div>
                <span class="color-name">
                    <label for="French_Blend">French Blend</label>
                </span>
                <input type="checkbox" id="French_Blend" name="French Blend" value="French Blend" class="color-checkbox" onchange="selectColor(this)">
            </div>
            <div class="color-folder">
                <div class="tile" id="Sage_Green_12x12">
                    <img src="static/images/9x9_Images/Sage Green.jpg" class="tile-image" alt="">
                    <!-- <img src="static/images/Sage_Green_12x12/Sage Green 12x12 F02.jpg" class="tile-image image2" alt="">
                    <img src="static/images/Sage_Green_12x12/Sage Green 12x12 F03.jpg" class="tile-image image3" alt="">
                    <img src="static/images/Sage_Green_12x12/Sage Green 12x12 F04.jpg" class="tile-image image4" alt="">
                    <img src="static/images/Sage_Green_12x12/Sage Green 12x12 F05.jpg" class="tile-image image5" alt=""> -->
                </div>
                <span class="color-name">
                    <label for="Sage_Green">Sage Green</label>
                </span>
                <input type="checkbox" id="Sage_Green" name="Sage Green" value="Sage Green" class="color-checkbox" onchange="selectColor(this)">
            </div>
            

        </div>
        <div id="selected-tiles">
            <div class="selected-tiles">
                <div class="selected-tile tile1">
                    <div class="selected-tile-image"></div>
                </div>
                <span class="selected-tile-color">&nbsp</span>
                <p>
                    <input type="text" id="first-color-percent" name="first-color-percent" value="50" class="color-percent">
                    <label for="first-color-percent">%</label>
                </p>
            </div>
            <div class="selected-tiles">
                <div class="selected-tile tile2">
                    <div class="selected-tile-image"></div>
                </div>
                <span class="selected-tile-color">&nbsp</span>
                <p>
                    <input type="text" id="second-color-percent" name="second-color-percent" value="50" class="color-percent">
                    <label for="second-color-percent">%</label>
                </p>
            </div>
        </div>
        <!-- <div class="tile-options">
            <div class="first-color color-selection" id ="first-color-group">
                <p>
                    <label for="first-color">First Color</label>
                    <input type="text" id="first-color-percent" name="first-color-percent" value="50" class="color-percent">
                    <label for="first-color-percent">%</label>
                </p>
            </div>
            <div class="second-color color-selection" id ="second-color-group">
                <p>
                    <label for="second-color">Second Color</label>
                    <input type="text" id="second-color-percent" name="second-color-percent" value="50" class="color-percent">
                    <label for="second-color-percent">%</label>
                </p>
            </div>
        </div> -->
        <div class="slidecontainer">
            <p>
                <label for="colorSlider">Select Color Mix</label>
            </p>
            <input type="range" min="0" max="100" value="50" class="slider" id="colorSlider" oninput="sliderChange()">
        </div>
        <div class="final-design-holder">
            <div class="final-design"> 
                <div class="final-design-row">
                    <div class="final-design-tile-holder grid-image-container half-left"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container half-right"></div>
                </div>
                <div class="row-border"></div>
                <div class="final-design-row move-up">
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                </div>
                <div class="row-border"></div>
                <div class="final-design-row move-up">
                    <div class="final-design-tile-holder grid-image-container half-left"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container half-right"></div>
                </div>
                <div class="row-border"></div>
                <div class="final-design-row move-up">
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                </div>
                <div class="row-border"></div>
                <div class="final-design-row move-up">
                    <div class="final-design-tile-holder grid-image-container half-left"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container half-right"></div>
                </div>
                <div class="row-border"></div>
                <div class="final-design-row move-up">
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                </div>
                <div class="row-border"></div>
                <div class="final-design-row move-up">
                    <div class="final-design-tile-holder grid-image-container half-left"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container half-right"></div>
                </div>
                <div class="row-border"></div>
                <div class="final-design-row move-up">
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                    <div class="final-design-tile-holder grid-image-container"></div>
                </div>
                <div class="row-border"></div>
            </div>
        </div>



        <script>
            let colorMatch = {
                DarkGrey: "Dark_Grey_2x2",
                AntiqueSlate: "Antique_Slate_2x2",
                EnglishGrey: "Ironstone_English_Grey_12x12",
                FrenchBlend: "Ironstone_French_Blend",
                SageGreen: "Sage_Green_2x2",
            }
            let imageNames = {
                DarkGrey: "Dark Grey 2x2 ",
                AntiqueSlate: "Antique Slate 2x2 ",
                EnglishGrey: "Ironstone English Grey 12x12 F",
                FrenchBlend: "Ironstone French Blend F",
                SageGreen: "Sage Green 2x2 ",
            }
            let imageCount = {
                DarkGrey: 21,
                AntiqueSlate: 19,
                EnglishGrey: 30,
                FrenchBlend: 65,
                SageGreen: 19
            }
            let cropPosstion = [
                "top-crop",
                "right-crop",
                "bottom-crop",
                "left-crop"
            ]
            let imageArray = []
            let imageOneNumbers = [];
            let imageTwoNumbers = [];
            let crop = '';
            let url = '';
            function getFolderName(color){
                return colorMatch[color.replaceAll(" ","")];
            }
            function generateFinalImage(){
                let firstColor = document.getElementsByClassName("selected-tile-color")[0].innerHTML;
                let secondColor = document.getElementsByClassName("selected-tile-color")[1].innerHTML;
                let finalDesignTiles = document.querySelectorAll(".final-design-tile-holder");
                let firstColorPercent = document.getElementById("first-color-percent").value;
                let secondColorPercent = document.getElementById("second-color-percent").value;
                let imageOneCount = imageCount[firstColor.replaceAll(" ","")];
                let imageTwoCount = imageCount[secondColor.replaceAll(" ","")];
                imageArray=[];
                let imageOneNumbers = [];
                let imageTwoNumbers = [];
                let a = 0;
                if (secondColor == "&nbsp;"){
                    secondColorPercent = 0;
                    firstColorPercent = 100;
                    for (let i=0; i<imageOneCount; i++){
                        for (let j=0; j<cropPosstion.length; j++){
                            imageOneNumbers.push([i+1, j])
                        }
                    }
                }
                else{
                    for (let i=0; i<imageOneCount; i++){
                        for (let j=0; j<cropPosstion.length; j++){
                            imageOneNumbers.push([i+1, j])
                        }
                    }
                    for (let i=0; i<imageTwoCount; i++){
                        for (let j=0; j<cropPosstion.length; j++){
                            imageTwoNumbers.push([i+1, j])
                        }
                    }
                }
                
                let firstColorCount = Math.round(108 * firstColorPercent / 100);
                let secondColorCount = Math.round(108 * secondColorPercent / 100);
                let folderOne = getFolderName(firstColor)
                let folderTwo = getFolderName(secondColor)
                let imageOne = imageNames[firstColor.replaceAll(" ","")];
                let imageTwo = imageNames[secondColor.replaceAll(" ","")];
                let imageOneArray = Array(firstColorCount).fill(folderOne);
                let imageTwoArray = Array(secondColorCount).fill(folderTwo);
                let imageName = imageOne
                let imageNumber = 1
                if (secondColor == "&nbsp;"){
                    colorMixArray = imageOneArray;
                }
                else{
                    colorMixArray = imageOneArray.concat(imageTwoArray);
                }
                colorMixArray = shuffle(colorMixArray)
                if(firstColor!="&nbsp;" && secondColor!="&nbsp;"){
                    for (let i = 0; i < finalDesignTiles.length; i++) {
                        if (colorMixArray[i] == folderOne){
                            imageName = imageOne;
                            [imageNumber, crop] = imageOneNumbers[Math.floor(Math.random() * imageOneNumbers.length)];
                            url = "static/images/" + colorMixArray[i] + "/" + imageName + padWithLeadingZeros(imageNumber, 2) + ".jpg"
                            a=0;
                            while (existinArray(imageArray, url+crop) && a<1000){
                                [imageNumber, crop] = imageOneNumbers[Math.floor(Math.random() * imageOneNumbers.length)];
                                url = "static/images/" + colorMixArray[i] + "/" + imageName + padWithLeadingZeros(imageNumber, 2) + ".jpg"
                                a++;
                            }
                        }
                        else{
                            imageName = imageTwo;
                            [imageNumber, crop] = imageTwoNumbers[Math.floor(Math.random() * imageTwoNumbers.length)];
                            url = "static/images/" + colorMixArray[i] + "/" + imageName + padWithLeadingZeros(imageNumber, 2) + ".jpg"
                            a=0;
                            while (existinArray(imageArray, url+crop) && a<1000){
                                [imageNumber, crop] = imageTwoNumbers[Math.floor(Math.random() * imageTwoNumbers.length)];
                                url = "static/images/" + colorMixArray[i] + "/" + imageName + padWithLeadingZeros(imageNumber, 2) + ".jpg"
                                a++;
                            }
                        }
                        
                        // [url, crop] = getUniqueImage(imageArray,colorMixArray[i],imageName,imageNumber, crop, imageCount, image)
                        if (a<1000){
                            imageArray.push(url+crop);
                        }
                        else{
                            console.log(a)
                            url="";
                        }
                        let classList = finalDesignTiles[i].classList;
                        addImages(url,finalDesignTiles[i], classList, cropPosstion[crop])

                        
                        url="";
                        // classList = addNewClass(classList,cropPosstion[crop])
                        // finalDesignTiles[i].classList = classList //.add(cropPosstion[crop]);
                        
                    }
                }
                else if(firstColor!="&nbsp;" && secondColor=="&nbsp;"){
                    for (let i=0; i< finalDesignTiles.length; i++){
                        [imageNumber, crop] = imageOneNumbers[Math.floor(Math.random() * imageOneNumbers.length)];
                        url = "static/images/" + colorMixArray[i] + "/" + imageName + padWithLeadingZeros(imageNumber, 2) + ".jpg"
                        imageName = imageOne;
                        [imageNumber, crop] = imageOneNumbers[Math.floor(Math.random() * imageOneNumbers.length)];
                        a=0;
                        while (existinArray(imageArray, url+crop) && a<1000){
                            [imageNumber, crop] = imageOneNumbers[Math.floor(Math.random() * imageOneNumbers.length)];
                            url = "static/images/" + colorMixArray[i] + "/" + imageName + padWithLeadingZeros(imageNumber, 2) + ".jpg"
                            a++;
                        }
                        if (a<1000){
                            imageArray.push(url+crop);
                        }
                        else{
                            url="";
                        }
                        let classList = finalDesignTiles[i].classList;
                        addImages(url,finalDesignTiles[i], classList, cropPosstion[crop])
                        
                        url="";
                        // classList = addNewClass(classList,cropPosstion[crop]);
                        // finalDesignTiles[i].classList = classList //.add(cropPosstion[crop]);
                    }
                }
                else{
                    for (let i = 0; i < finalDesignTiles.length; i++) {
                        finalDesignTiles[i].style.backgroundImage = "";
                    }
                    alert("Please select at least one color to generate the final image.")
                    rows = document.querySelectorAll(".row-border");
                    for (const row of rows) {
                        row.style.visibility = "hidden";
                    }
                }
                
            }
            function addImages(url,tile, classList, crop){
                let image = document.createElement("img");
                image.classList.add("grid-image");
                image.classList.add(crop);
                image.src = url;
                lastClass = classList[classList.length-1];
                if (lastClass.includes("half")){
                    tile.style.maxWidth = "32.5px";
                    tile.style.height = "65px";
                    if (lastClass.includes("left")){
                        image.style.marginLeft = "-100%";
                    }
                }
                tile.appendChild(image)
            }
            function addNewClass(classList, newClass){
                classList=classList.toString();              
                let firstClass = classList.split(" ")[0];
                if (firstClass!="final-design-tile"){
                    return classList.replace(firstClass, newClass)
                }
                return  newClass + " " + classList;
            }

            const shuffle = (array) => { 
                for (let i = array.length - 1; i > 0; i--) { 
                    const j = Math.floor(Math.random() * (i + 1)); 
                    [array[i], array[j]] = [array[j], array[i]]; 
                } 
                return array; 
            }; 
            function existinArray(array, value){
                for (let j = 0; j < array.length; j++) {
                    if (array[j] == value){
                        return true;
                    }
                }
                return false;
            }
            
            function closeFolder() {
                document.querySelector("#image-container").innerHTML = "";
                document.querySelector(".popup").style.display = "none";
            }

            function fileExists(url) {
                    if(url){
                        var req = new XMLHttpRequest();
                        req.open('GET', url, false);
                        req.send();
                        return req.status==200;
                    } else {
                        return false;
                    }
                }
            function padWithLeadingZeros(num, totalLength) {
                return String(num).padStart(totalLength, '0');
            }
                
            function selectColor(chb){
                rows = document.querySelectorAll(".row-border");
                    for (const row of rows) {
                        row.style.visibility = "visible";
                    }
                let selected_tiles = document.querySelectorAll(".selected-tile-image");
                if (chb.checked){
                    let j = 0;
                    for (let i = 0; i < selected_tiles.length; i++) {
                        if (selected_tiles[i].style.backgroundImage == "") {
                            selected_tiles[i].style.backgroundImage = "url('../static/images/9x9_Images/" + chb.value + ".jpg')";
                            selected_tiles[i].parentElement.parentElement.getElementsByClassName("selected-tile-color")[0].innerHTML = chb.value;
                            // selected_tiles[i].classList.add(image.classList[1]);
                            selected_tiles[i].onclick=()=>{
                                selected_tiles = document.querySelectorAll(".selected-tile-image");
                                selected_tiles[i].style.backgroundImage = "";
                                let color = selected_tiles[i].parentElement.parentElement.getElementsByClassName("selected-tile-color")[0].innerHTML;
                                selected_tiles[i].parentElement.parentElement.getElementsByClassName("selected-tile-color")[0].innerHTML ="&nbsp"
                                adjustImages(color);
                                generateFinalImage()
                            }
                            generateFinalImage()
                            break;
                        }
                        else{
                            j++;
                        }
                    }
                    if (j == selected_tiles.length){
                        alert("You have selected all the tiles. Please deselect a tile to select a new one.")
                        chb.checked = false;
                    }
                    selected_tiles=null;
                }
                else{
                    for (let i = 0; i < selected_tiles.length; i++) {
                        if (selected_tiles[i].style.backgroundImage.replaceAll("\"","'") == "url('../static/images/9x9_Images/" + chb.value + ".jpg')") {
                            selected_tiles[i].style.backgroundImage = "";
                            let color = selected_tiles[i].parentElement.parentElement.getElementsByClassName("selected-tile-color")[0].innerHTML;
                            selected_tiles[i].parentElement.parentElement.getElementsByClassName("selected-tile-color")[0].innerHTML ="&nbsp"
                            
                            adjustImages(color);
                            generateFinalImage()
                            selected_tiles=null;
                            break;
                        }
                    }
                }
                        
            }

            function adjustImages(color){
                let selected_tiles = document.querySelectorAll(".selected-tile-image");
                for (let i = 0; i < selected_tiles.length-1; i++) {
                    if (selected_tiles[i].style.backgroundImage == "") {
                        if (i < selected_tiles.length) {
                            selected_tiles[i].style.backgroundImage = selected_tiles[i+1].style.backgroundImage;
                            selected_tiles[i].classList.remove(selected_tiles[i].classList[1]);
                            if (selected_tiles[i+1].classList[1] != undefined){
                                selected_tiles[i].classList.add(selected_tiles[i+1].classList[1]);
                            }
                            
                            selected_tiles[i+1].style.backgroundImage = "";
                            document.getElementsByName(color)[0].checked = false;
                            selected_tiles[i].parentElement.parentElement.getElementsByClassName("selected-tile-color")[0].innerHTML =selected_tiles[i+1].parentElement.parentElement.getElementsByClassName("selected-tile-color")[0].innerHTML
                            selected_tiles[i+1].parentElement.parentElement.getElementsByClassName("selected-tile-color")[0].innerHTML ="&nbsp"
                            selected_tiles[i+1].classList.remove(selected_tiles[i+1].classList[1]);
                            
                        }
                    }
                }
                selected_tiles=null;
            }

            function sliderChange(){
                let slider = document.getElementById("colorSlider");
                document.getElementById("first-color-percent").value = slider.value //"<label for='first-color'>" + slider.value + "%</label>";
                document.getElementById("second-color-percent").value = 100-parseInt(slider.value) //"<label for='second-color'>" + (100-parseInt(slider.value)) + "%</label>";
                generateFinalImage();
                slider=null;
            }
            var firstColor = document.getElementById("first-color-percent");
            var secondColor = document.getElementById("second-color-percent");
            firstColor.addEventListener("change", textChange);
            secondColor.addEventListener("change", textChange);
            function textChange(e){
                let slider = document.getElementById("colorSlider");
                if (e.target.id=="first-color-percent"){
                    slider.value = firstColor.value;
                    secondColor.value = 100-parseInt(slider.value);
                }
                else{
                    slider.value = 100-parseInt(secondColor.value);
                    firstColor.value = slider.value;
                }
                generateFinalImage();
            }


        </script>
    </body>
</html>